<!DOCTYPE HTML>
<!--
    Story by HTML5 UP
    html5up.net | @ajlkn
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->

<html>
    <head>
        <title>Bikesoft for EZ-Alarm</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
        <link rel="stylesheet" href="assets/css/main.css" />
        <!-- 引入 Leaflet CSS -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    </head>

    <body class="is-preload">

        <!-- Wrapper -->
            <div id="wrapper" class="divided">

                <!-- One -->
                    <section class="banner style1 orient-left content-align-left image-position-right fullscreen onload-image-fade-in onload-content-fade-right" style="height:500px">
                        <div class="content">
                            <h2>Bikesoft for EZ-Alarm</h2>
                            <p class="major">EZ-Alarm by <a href="https://carbajalaustin.wixsite.com/team-9-product-devel">Group 9</a>.</p>
                            <p class="major">Bikesoft for EZ-Alarm is a website that allows you to control your EZ-Alarm from any device. You can check the status of your alarm from anywhere in the world.</p>
                        </div>
                        <div id="map" style="width: 100%; height: 100%;"></div>
                        
                    </section>

            </div>

        <!-- Scripts -->
            <script src="assets/js/jquery.min.js"></script>
            <script src="assets/js/jquery.scrollex.min.js"></script>
            <script src="assets/js/jquery.scrolly.min.js"></script>
            <script src="assets/js/browser.min.js"></script>
            <script src="assets/js/breakpoints.min.js"></script>
            <script src="assets/js/util.js"></script>
            <script src="assets/js/main.js"></script>
        <!-- 引入 Leaflet JS -->
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
        <script>
            // 初始化地图，并设置初始视图
            var map = L.map('map').setView([0, 0], 2);

            // 添加地图瓦片层
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors',
                noWrap: true
            }).addTo(map);

            // 初始化标记
            var marker = L.marker([0, 0]).addTo(map);
            marker.bindPopup("The current position of your bike.");

            // 定义更新位置的函数
            async function updateLocation() {
                try {
                    const response = await fetch('https://bikesoft-backend.onrender.com/location');
                    if (response.ok) {
                        const data = await response.json();
                        const { latitude, longitude } = data;

                        if (latitude && longitude) {
                            // 更新地图视图和标记位置
                            map.setView([latitude, longitude], 15);
                            marker.setLatLng([latitude, longitude]);
                        } else {
                            console.error('Location data is incomplete.');
                        }
                    } else {
                        console.error('No location data available.');
                    }
                } catch (error) {
                    console.error('Error fetching location:', error);
                }
            }

            // 初次加载时调用
            updateLocation();

            // 每隔 30 秒更新一次位置
            setInterval(updateLocation, 30000);
        </script>
        
    </body>
</html>
